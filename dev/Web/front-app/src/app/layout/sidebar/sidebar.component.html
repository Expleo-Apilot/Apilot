<div class="sidebar-container">
  <div class="sidebar-nav">
    <div class="nav-item" [class.active]="activeNavItem === 'collections'" (click)="setActiveNavItem('collections')">
      <mat-icon>folder</mat-icon>
      <span>Collections</span>
    </div>
    <div class="nav-item" [class.active]="activeNavItem === 'environments'" (click)="setActiveNavItem('environments')">
      <mat-icon>layers</mat-icon>
      <span>Env</span>
    </div>
    <div class="nav-item" [class.active]="activeNavItem === 'history'" (click)="setActiveNavItem('history')">
      <mat-icon>history</mat-icon>
      <span>History</span>
    </div>
  </div>

  <div class="sidebar-content">
    <div *ngIf="activeNavItem === 'collections'" class="content-area collections-area">
      <div class="content-header">
        <div class="action-buttons">
          <button mat-icon-button (click)="toggleCollectionsMenu($event)">
            <mat-icon>more_vert</mat-icon>
          </button>
        </div>
        <div class="search-area">
          <mat-icon class="filter-icon">filter_list</mat-icon>
          <input type="text" placeholder="Filter" class="search-input">
        </div>
      </div>

      <!-- Collections Menu Dropdown -->
      <div *ngIf="showCollectionsMenu" class="collections-menu-overlay">
        <div class="collections-menu-wrapper" [style.top]="menuPosition.top" [style.left]="menuPosition.left">
          <div class="menu-item" (click)="createNewCollection()">
            <mat-icon>add</mat-icon>
            <span>New Collection</span>
          </div>
          <div class="menu-item" (click)="importCollection()">
            <mat-icon>upload_file</mat-icon>
            <span>Import Collection</span>
          </div>
        </div>
      </div>
      
      <!-- Item Context Menu Dropdown -->
      <div *ngIf="showItemMenu" class="item-menu-overlay">
        <div class="item-menu-wrapper" [style.top]="itemMenuPosition.top" [style.left]="itemMenuPosition.left">
          <!-- Collection-specific options -->
          <ng-container *ngIf="activeItemType === 'collection'">
            <div class="menu-item" (click)="createNewRequest('collection', activeItemId!)">
              <mat-icon>add</mat-icon>
              <span>New Request</span>
            </div>
            <div class="menu-item" (click)="createNewFolder(activeItemId!)">
              <mat-icon>create_new_folder</mat-icon>
              <span>New Folder</span>
            </div>
            <div class="menu-divider"></div>
            <div class="menu-item" (click)="editItem('collection', activeItemId!)">
              <mat-icon>edit</mat-icon>
              <span>Edit</span>
            </div>
            <div class="menu-item danger" (click)="deleteItem('collection', activeItemId!)">
              <mat-icon>delete</mat-icon>
              <span>Delete</span>
            </div>
          </ng-container>
          
          <!-- Folder-specific options -->
          <ng-container *ngIf="activeItemType === 'folder'">
            <div class="menu-item" (click)="createNewRequest('folder', activeItemId!)">
              <mat-icon>add</mat-icon>
              <span>New Request</span>
            </div>
            <div class="menu-divider"></div>
            <div class="menu-item" (click)="editItem('folder', activeItemId!)">
              <mat-icon>edit</mat-icon>
              <span>Edit</span>
            </div>
            <div class="menu-item danger" (click)="deleteItem('folder', activeItemId!)">
              <mat-icon>delete</mat-icon>
              <span>Delete</span>
            </div>
          </ng-container>
          
          <!-- Request-specific options -->
          <ng-container *ngIf="activeItemType === 'request'">
            <div class="menu-item" (click)="editItem('request', activeItemId!)">
              <mat-icon>edit</mat-icon>
              <span>Edit</span>
            </div>
            <div class="menu-item danger" (click)="deleteItem('request', activeItemId!)">
              <mat-icon>delete</mat-icon>
              <span>Delete</span>
            </div>
          </ng-container>
        </div>
      </div>

      <div class="collections-list">
        <div *ngFor="let collection of collections" class="collection-item">
          <div class="collection-header" (click)="toggleExpand(collection.id)">
            <div class="collection-icon">
              <mat-icon>{{ isExpanded(collection.id) ? 'inventory_2' : 'inventory' }}</mat-icon>
            </div>
            <span class="collection-name">{{ collection.name }}</span>
            <div class="collection-actions">
              <button mat-icon-button class="action-button" (click)="toggleItemMenu($event, 'collection', collection.id)">
                <mat-icon>more_horiz</mat-icon>
              </button>
            </div>
          </div>

          <div *ngIf="isExpanded(collection.id)" class="collection-content">
            <!-- Collection's requests -->
            <div cdkDropList
                 [id]="'collection-' + collection.id"
                 [cdkDropListConnectedTo]="getConnectedLists()"
                 (cdkDropListDropped)="onDrop($event)"
                 class="request-list"
                 [cdkDropListData]="collection.requests">
              <div *ngFor="let request of collection.requests"
                   class="request-item"
                   cdkDrag
                   [cdkDragData]="request"
                   (cdkDragStarted)="onDragStarted(request)"
                   (cdkDragEnded)="onDragEnded()">
                <div class="request-header">
                  <mat-icon>subdirectory_arrow_right</mat-icon>
                  <span class="request-method" [ngClass]="request.method.toLowerCase()">{{ request.method }}</span>
                  <span>{{ request.name }}</span>
                </div>
              </div>
            </div>

            <!-- Collection's folders -->
            <div cdkDropList
                 [id]="'collection-folders-' + collection.id"
                 [cdkDropListConnectedTo]="getConnectedLists()"
                 (cdkDropListDropped)="onDrop($event)"
                 class="folder-list"
                 [cdkDropListData]="collection.folders">
              <div *ngFor="let folder of collection.folders"
                   class="folder-item"
                   cdkDrag
                   [cdkDragData]="folder"
                   (cdkDragStarted)="onDragStarted(folder)"
                   (cdkDragEnded)="onDragEnded()">
                <div class="folder-header" (click)="toggleExpand(folder.id)">
                  <div class="folder-icon">
                    <mat-icon>{{ isExpanded(folder.id) ? 'folder_open' : 'folder' }}</mat-icon>
                  </div>
                  <span class="folder-name">{{ folder.name }}</span>
                  <div class="folder-actions">
                    <button mat-icon-button class="action-button small" (click)="toggleItemMenu($event, 'folder', folder.id)">
                      <mat-icon class="small-icon">more_horiz</mat-icon>
                    </button>
                  </div>
                </div>

                <div *ngIf="isExpanded(folder.id)" class="folder-content">
                  <!-- Folder's requests -->
                  <div cdkDropList
                       [id]="'folder-' + folder.id"
                       [cdkDropListConnectedTo]="getFolderConnectedLists(folder)"
                       (cdkDropListDropped)="onDrop($event)"
                       class="request-list"
                       [cdkDropListData]="folder.requests">
                    <div *ngFor="let request of folder.requests"
                         class="request-item"
                         cdkDrag
                         [cdkDragData]="request"
                         (cdkDragStarted)="onDragStarted(request)"
                         (cdkDragEnded)="onDragEnded()">
                      <div class="request-header">
                        <div class="request-icon">
                          <span class="request-method" [ngClass]="request.method.toLowerCase()">{{ request.method }}</span>
                        </div>
                        <span class="request-name">{{ request.name }}</span>
                        <div class="request-actions">
                          <button mat-icon-button class="action-button small" (click)="toggleItemMenu($event, 'request', request.id)">
                            <mat-icon class="small-icon">more_horiz</mat-icon>
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Nested folders -->

                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="activeNavItem === 'environments'" class="content-area environments-area">
      <div class="content-header">
        <span class="area-title">Environments</span>
        <button mat-icon-button><mat-icon>add</mat-icon></button>
      </div>
      <div class="environments-list">
        <div class="environment-item">
          <span>Development</span>
        </div>
        <div class="environment-item">
          <span>Staging</span>
        </div>
        <div class="environment-item">
          <span>Production</span>
        </div>
      </div>
    </div>

    <div *ngIf="activeNavItem === 'flows'" class="content-area flows-area">
      <div class="content-header">
        <span class="area-title">Flows</span>
        <button mat-icon-button><mat-icon>add</mat-icon></button>
      </div>
      <div class="no-flows">
        <p>No flows available</p>
        <button mat-button color="primary">Create Flow</button>
      </div>
    </div>

    <div *ngIf="activeNavItem === 'history'" class="content-area history-area">
      <div class="content-header">
        <span class="area-title">History</span>
        <div class="action-buttons">
          <button mat-icon-button><mat-icon>filter_list</mat-icon></button>
          <button mat-icon-button><mat-icon>more_vert</mat-icon></button>
        </div>
      </div>
      <div class="history-list">
        <div class="history-item">
          <div class="request-info">
            <span class="request-method get">GET</span>
            <span class="request-url">/api/books</span>
          </div>
          <span class="request-time">10:30 AM</span>
        </div>
        <div class="history-item">
          <div class="request-info">
            <span class="request-method post">POST</span>
            <span class="request-url">/api/books</span>
          </div>
          <span class="request-time">Yesterday</span>
        </div>
        <div class="history-item">
          <div class="request-info">
            <span class="request-method put">PUT</span>
            <span class="request-url">/api/books/1</span>
          </div>
          <span class="request-time">May 5</span>
        </div>
      </div>
    </div>
  </div>

<!-- New Collection Modal -->
<div *ngIf="showNewCollectionModal" class="modal-overlay">
  <div class="modal-container">
    <div class="modal-header">
      <h2>Create New Collection</h2>
      <button mat-icon-button (click)="closeNewCollectionModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <div class="modal-content">
      <form (ngSubmit)="submitNewCollection()">
        <div class="form-group">
          <label for="collectionName">Name</label>
          <input
            type="text"
            id="collectionName"
            name="collectionName"
            [(ngModel)]="newCollection.name"
            placeholder="Enter collection name"
            required
            autocomplete="off"
          >
        </div>
        <div class="form-group">
          <label for="collectionDescription">Description</label>
          <textarea
            id="collectionDescription"
            name="collectionDescription"
            [(ngModel)]="newCollection.description"
            placeholder="Enter collection description"
            rows="3"
          ></textarea>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-secondary" (click)="closeNewCollectionModal()">Cancel</button>
          <button type="submit" class="btn-primary" [disabled]="!newCollection.name">Create</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Edit Collection Modal -->
<div *ngIf="showEditCollectionModal" class="modal-overlay">
  <div class="modal-container">
    <div class="modal-header">
      <h2>Edit Collection</h2>
      <button mat-icon-button (click)="closeEditCollectionModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <div class="modal-content">
      <form (ngSubmit)="submitEditCollection()">
        <div class="form-group">
          <label for="editCollectionName">Name</label>
          <input
            type="text"
            id="editCollectionName"
            name="editCollectionName"
            [(ngModel)]="editCollection.name"
            placeholder="Enter collection name"
            required
            autocomplete="off"
          >
        </div>
        <div class="form-group">
          <label for="editCollectionDescription">Description</label>
          <textarea
            id="editCollectionDescription"
            name="editCollectionDescription"
            [(ngModel)]="editCollection.description"
            placeholder="Enter collection description"
            rows="3"
          ></textarea>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-secondary" (click)="closeEditCollectionModal()">Cancel</button>
          <button type="submit" class="btn-primary" [disabled]="!editCollection.name">Update</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div *ngIf="showDeleteConfirmModal" class="modal-overlay">
  <div class="modal-container delete-confirm-modal">
    <div class="modal-header">
      <h2>Delete Collection</h2>
      <button mat-icon-button (click)="closeDeleteConfirmModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <div class="modal-content">
      <div class="confirm-message">
        <mat-icon class="warning-icon">warning</mat-icon>
        <p>Are you sure you want to delete the collection <strong>"{{ currentCollection?.name }}"</strong>?</p>
        <p class="warning-text">This action cannot be undone. All requests and folders within this collection will be permanently deleted.</p>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-secondary" (click)="closeDeleteConfirmModal()">Cancel</button>
        <button type="button" class="btn-danger" (click)="confirmDeleteCollection()">Delete</button>
      </div>
    </div>
  </div>
</div>

<!-- New Folder Modal -->
<div *ngIf="showNewFolderModal" class="modal-overlay">
  <div class="modal-container">
    <div class="modal-header">
      <h2>Create New Folder</h2>
      <button mat-icon-button (click)="closeNewFolderModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <div class="modal-content">
      <form (ngSubmit)="submitNewFolder()">
        <div class="form-group">
          <label for="folderName">Name</label>
          <input
            type="text"
            id="folderName"
            name="folderName"
            [(ngModel)]="newFolder.name"
            placeholder="Enter folder name"
            required
            autocomplete="off"
          >
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-secondary" (click)="closeNewFolderModal()">Cancel</button>
          <button type="submit" class="btn-primary" [disabled]="!newFolder.name">Create</button>
        </div>
      </form>
    </div>
  </div>
</div>
</div>
